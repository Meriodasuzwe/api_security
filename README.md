–ö—É—Ä—Å–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞ –ø–æ —Ç–µ–º–µ: "–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å REST API"

–í—ã–ø–æ–ª–Ω–∏–ª: [–ê–ª–∏–µ–≤ –†.–ê.]
–ü—Ä–æ–≤–µ—Ä–∏–ª: [–®–µ–≥–µ—Ç–∞–µ–≤–∞ –ê.–ö]

1. –í–≤–µ–¥–µ–Ω–∏–µ

–î–∞–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º–Ω—É—é –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é ("–ü–∞–Ω–µ–ª—å –•–∞–∫–µ—Ä–∞"), –∫–æ—Ç–æ—Ä–∞—è –Ω–∞–≥–ª—è–¥–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç—Ä–∏ –Ω–∞–∏–±–æ–ª–µ–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö REST API, —Å–æ–≥–ª–∞—Å–Ω–æ —Å–ø–∏—Å–∫—É OWASP API Security Top 10.

–ü—Ä–æ–µ–∫—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö —á–∞—Å—Ç–µ–π:

main.py (–°–µ—Ä–≤–µ—Ä API): –ë—ç–∫–µ–Ω–¥-—Å–µ—Ä–≤–µ—Ä –Ω–∞ FastAPI, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–∞–∫ —É—è–∑–≤–∏–º—ã–µ ("–ø–ª–æ—Ö–∏–µ") —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã, —Ç–∞–∫ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ ("—Ö–æ—Ä–æ—à–∏–µ") –≤–µ—Ä—Å–∏–∏.

dashboard.py (–ü–∞–Ω–µ–ª—å –•–∞–∫–µ—Ä–∞): –í–∏–∑—É–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞ Streamlit, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–∏–º—É–ª—è—Ü–∏–∏ –∞—Ç–∞–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∏ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –≤–∏–¥–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî —É–¥–∞–ª–∞—Å—å –∞—Ç–∞–∫–∞ –∏–ª–∏ –±—ã–ª–∞ –æ—Ç–±–∏—Ç–∞.

2. –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∑–∞–ø—É—Å–∫—É

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: pip install fastapi uvicorn sqlalchemy streamlit requests passlib[argon2] python-jose[cryptography]

–¢–µ—Ä–º–∏–Ω–∞–ª 1 (–°–µ—Ä–≤–µ—Ä): –ó–∞–ø—É—Å—Ç–∏—Ç—å uvicorn main:app

–¢–µ—Ä–º–∏–Ω–∞–ª 2 (–î–∞—à–±–æ—Ä–¥): –ó–∞–ø—É—Å—Ç–∏—Ç—å streamlit run dashboard.py

3. –ê–Ω–∞–ª–∏–∑ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏–µ

–£—è–∑–≤–∏–º–æ—Å—Ç—å 1: A01:2023 - Broken Object Level Authorization (BOLA / IDOR)

–°—É—Ç—å: –£—è–∑–≤–∏–º–æ—Å—Ç—å, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ê –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ë, –ø—Ä–æ—Å—Ç–æ —É–≥–∞–¥–∞–≤/–ø–µ—Ä–µ–±—Ä–∞–≤ ID –æ–±—ä–µ–∫—Ç–∞ –≤ URL.

"–ü–ª–æ—Ö–æ–π" –ö–æ–¥ (main.py):

–≠–Ω–¥–ø–æ–∏–Ω—Ç /notes/{note_id} –ø—Ä–æ—Å—Ç–æ –±–µ—Ä–µ—Ç ID –∑–∞–º–µ—Ç–∫–∏ –∏ –∏—â–µ—Ç –µ–µ –≤ –±–∞–∑–µ, –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—è, –∫—Ç–æ –µ–µ –∑–∞–ø—Ä–æ—Å–∏–ª.

@app.get("/notes/{note_id}", ...)
def get_note_by_id(note_id: int, ...):
    # üêû –£–Ø–ó–í–ò–ú–û–°–¢–¨: –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ 'owner_id'
    note = db.query(Note).filter(Note.id == note_id).first()
    if note is None:
        raise HTTPException(...)
    return note


"–•–æ—Ä–æ—à–∏–π" –ö–æ–¥ (main.py):

–≠–Ω–¥–ø–æ–∏–Ω—Ç /secure/notes/{note_id} —Ç—Ä–µ–±—É–µ—Ç —Ç–æ–∫–µ–Ω –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (current_user). –û–Ω –∏—â–µ—Ç –∑–∞–º–µ—Ç–∫—É, —É –∫–æ—Ç–æ—Ä–æ–π ID —Å–æ–≤–ø–∞–¥–∞–µ—Ç –ò owner_id —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Ç–æ–∫–µ–Ω–∞.

@app.get("/secure/notes/{note_id}", ...)
def get_secure_note_by_id(..., current_user: User = Depends(get_current_user)):
    # üîí –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º –ò ID –∑–∞–º–µ—Ç–∫–∏, –ò ID –≤–ª–∞–¥–µ–ª—å—Ü–∞
    note = db.query(Note).filter(
        Note.id == note_id, 
        Note.owner_id == current_user.id
    ).first()
    if note is None:
        raise HTTPException(...)
    return note


–†–µ–∑—É–ª—å—Ç–∞—Ç –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ (—Å –î–∞—à–±–æ—Ä–¥–∞):

--- üí• –ù–∞—á–∏–Ω–∞—é –∞—Ç–∞–∫—É IDOR (BOLA) ---

[–®–∞–≥ 3] (–ê—Ç–∞–∫–∞) –ü—ã—Ç–∞—é—Å—å —É–∫—Ä–∞—Å—Ç—å –∑–∞–º–µ—Ç–∫—É –ë–æ–±–∞ (ID=2) —Å '–ü–õ–û–•–û–ì–û' /notes/...
–†–µ–∑—É–ª—å—Ç–∞—Ç: 200
üî• –£–°–ü–ï–• –ê–¢–ê–ö–ò! –£–∫—Ä–∞–¥–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: {"id": 2, "title": "–°–µ–∫—Ä–µ—Ç –ë–æ–±–∞", ...}

[–®–∞–≥ 4] (–ê—Ç–∞–∫–∞) –ü—ã—Ç–∞—é—Å—å —É–∫—Ä–∞—Å—Ç—å –∑–∞–º–µ—Ç–∫—É –ë–æ–±–∞ (ID=2) —Å '–•–û–†–û–®–ï–ì–û' /secure/...
–†–µ–∑—É–ª—å—Ç–∞—Ç: 404
üîí –ê–¢–ê–ö–ê –û–¢–ë–ò–¢–ê! –°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª: {"detail": "–ó–∞–º–µ—Ç–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ —É –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞"}


–£—è–∑–≤–∏–º–æ—Å—Ç—å 2: A02:2023 - Broken Authentication (–ë—Ä—É—Ç—Ñ–æ—Ä—Å)

–°—É—Ç—å: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞—â–∏—Ç—ã –æ—Ç –ø–µ—Ä–µ–±–æ—Ä–∞ –ø–∞—Ä–æ–ª–µ–π (–ë—Ä—É—Ç—Ñ–æ—Ä—Å-–∞—Ç–∞–∫–∞). –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç 1000 —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É –ø—Ä–æ–±–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –ø–∞—Ä–æ–ª–∏.

–†–µ—à–µ–Ω–∏–µ (main.py):

–í–Ω–µ–¥—Ä–µ–Ω "–æ–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª—å —Å–∫–æ—Ä–æ—Å—Ç–∏" (Rate Limiter). –û–Ω —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤—Ä—É—á–Ω—É—é (–±–µ–∑ —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫, –∫–æ—Ç–æ—Ä—ã–µ –¥–∞–≤–∞–ª–∏ —Å–±–æ–π) –∏ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏.

–õ–æ–≥–∏–∫–∞:

–°–æ–∑–¥–∞–µ—Ç—Å—è —Å–ª–æ–≤–∞—Ä—å limiter_storage, –≥–¥–µ –∫–ª—é—á ‚Äî IP-–∞–¥—Ä–µ—Å.

–ö–∞–∂–¥–∞—è –ø–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞ —Å –æ–¥–Ω–æ–≥–æ IP (request.client.host) —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—á–µ—Ç—á–∏–∫.

–ï—Å–ª–∏ —Å—á–µ—Ç—á–∏–∫ –ø—Ä–µ–≤—ã—à–∞–µ—Ç LOGIN_ATTEMPTS (5 –ø–æ–ø—ã—Ç–æ–∫) –∑–∞ LOGIN_WINDOW_SECONDS (60 —Å–µ–∫—É–Ω–¥) ‚Äî —Å–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É 429 Too Many Requests.

# –ù–∞—à —Ä—É—á–Ω–æ–π Rate Limiter
limiter_storage = defaultdict(...)
LOGIN_ATTEMPTS = 5
LOGIN_WINDOW_SECONDS = 60

def rate_limit_check(request: Request):
    ip = request.client.host
    # ... (–ª–æ–≥–∏–∫–∞ –ø–æ–¥—Å—á–µ—Ç–∞) ...
    if limiter_storage[ip]["count"] > LOGIN_ATTEMPTS:
        # üîí –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ö–∏–¥–∞–µ–º –æ—à–∏–±–∫—É 429
        raise HTTPException(
            status_code=status.HTTP_429_TOO_MANY_REQUESTS,
            detail="–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ –º–∏–Ω—É—Ç—É.",
        )


–†–µ–∑—É–ª—å—Ç–∞—Ç –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ (—Å –î–∞—à–±–æ—Ä–¥–∞):

--- üí• –ù–∞—á–∏–Ω–∞—é –∞—Ç–∞–∫—É –ë—Ä—É—Ç—Ñ–æ—Ä—Å ---
–ü—ã—Ç–∞—é—Å—å 7 —Ä–∞–∑ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É —Å –Ω–µ–≤–µ—Ä–Ω—ã–º –ø–∞—Ä–æ–ª–µ–º...

–ü–æ–ø—ã—Ç–∫–∞ 1: –†–µ–∑—É–ª—å—Ç–∞—Ç 401 (–ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –ø–∞—Ä–æ–ª—å)
–ü–æ–ø—ã—Ç–∫–∞ 2: –†–µ–∑—É–ª—å—Ç–∞—Ç 401 (–ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –ø–∞—Ä–æ–ª—å)
–ü–æ–ø—ã—Ç–∫–∞ 3: –†–µ–∑—É–ª—å—Ç–∞—Ç 401 (–ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –ø–∞—Ä–æ–ª—å)
–ü–æ–ø—ã—Ç–∫–∞ 4: –†–µ–∑—É–ª—å—Ç–∞—Ç 401 (–ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –ø–∞—Ä–æ–ª—å)
–ü–æ–ø—ã—Ç–∫–∞ 5: –†–µ–∑—É–ª—å—Ç–∞—Ç 401 (–ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –ø–∞—Ä–æ–ª—å)
–ü–æ–ø—ã—Ç–∫–∞ 6: –†–µ–∑—É–ª—å—Ç–∞—Ç 429 üî• (–°–õ–ò–®–ö–û–ú –ú–ù–û–ì–û –ó–ê–ü–†–û–°–û–í)

üîí –ê–¢–ê–ö–ê –û–¢–ë–ò–¢–ê! –°–µ—Ä–≤–µ—Ä –Ω–∞—Å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª (Rate Limit).


–£—è–∑–≤–∏–º–æ—Å—Ç—å 3: A03:2023 - SQL-–∏–Ω—ä–µ–∫—Ü–∏—è

–°—É—Ç—å: –£—è–∑–≤–∏–º–æ—Å—Ç—å, –ø–æ–∑–≤–æ–ª—è—é—â–∞—è –≤–Ω–µ–¥—Ä–∏—Ç—å –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π SQL-–∫–æ–¥ –≤ –∑–∞–ø—Ä–æ—Å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ–±—ã –æ–±–æ–π—Ç–∏ –ª–æ–≥–∏–∫—É –∏ —É–∫—Ä–∞—Å—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ.

"–ü–ª–æ—Ö–æ–π" –ö–æ–¥ (main.py):

–≠–Ω–¥–ø–æ–∏–Ω—Ç /search/bad –∏—Å–ø–æ–ª—å–∑—É–µ—Ç f-—Å—Ç—Ä–æ–∫—É Python –¥–ª—è –ø—Ä—è–º–æ–π –≤—Å—Ç–∞–≤–∫–∏ "—Å—ã—Ä–æ–≥–æ" –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞ (query) –≤ SQL-–∑–∞–ø—Ä–æ—Å.

@app.get("/search/bad", ...)
def search_bad(query: Optional[str] = "", ...):
    # üêû –£–Ø–ó–í–ò–ú–û–°–¢–¨: f-—Å—Ç—Ä–æ–∫–∞ –≤ SQL-–∑–∞–ø—Ä–æ—Å–µ
    raw_sql = f"SELECT * FROM notes WHERE title LIKE '%{query}%'"
    results = db.execute(text(raw_sql)).fetchall()
    return results


–ï—Å–ª–∏ query = ' OR 1=1; --, —Ç–æ –∏—Ç–æ–≥–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è:
SELECT * FROM notes WHERE title LIKE '%' OR 1=1; --%'
–ß–∞—Å—Ç—å OR 1=1 –≤—Å–µ–≥–¥–∞ –∏—Å—Ç–∏–Ω–Ω–∞, –∏ WHERE –æ—Ç–¥–∞–µ—Ç –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã.

"–•–æ—Ä–æ—à–∏–π" –ö–æ–¥ (main.py):

–≠–Ω–¥–ø–æ–∏–Ω—Ç /search/good –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –º–µ—Ç–æ–¥ SQLAlchemy ORM). –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Å–∞–º–∞ "—ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç" –≤–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∏ –æ–Ω –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –∫–∞–∫ –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç, –∞ –Ω–µ –∫–∞–∫ –∫–æ–º–∞–Ω–¥–∞.

@app.get("/search/good", ...)
def search_good(query: Optional[str] = "", ...):
    # üîí –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: SQLAlchemy (ORM) –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–µ–∑–æ–ø–∞—Å–µ–Ω
    search_query = f"%{query}%"
    results = db.query(Note).filter(Note.title.like(search_query)).all()
    return results


–ï—Å–ª–∏ query = ' OR 1=1; --, SQLAlchemy –±—É–¥–µ—Ç –∏—Å–∫–∞—Ç—å –∑–∞–º–µ—Ç–∫—É —Å –±—É–∫–≤–∞–ª—å–Ω—ã–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º ' OR 1=1; -- –∏, –∫–æ–Ω–µ—á–Ω–æ, –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ—Ç.

–†–µ–∑—É–ª—å—Ç–∞—Ç –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ (—Å –î–∞—à–±–æ—Ä–¥–∞):

--- üí• –ù–∞—á–∏–Ω–∞—é –∞—Ç–∞–∫—É SQL-–∏–Ω—ä–µ–∫—Ü–∏–µ–π ---
–°—Ç—Ä–æ–∫–∞ –∞—Ç–∞–∫–∏: ' OR 1=1; --

[–®–∞–≥ 1] –ê—Ç–∞–∫—É—é '–ü–õ–û–•–û–ô' /search/bad...
–†–µ–∑—É–ª—å—Ç–∞—Ç: 200
üî• –£–°–ü–ï–• –ê–¢–ê–ö–ò! –°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª 2 –∑–∞–ø–∏—Å–µ–π:
  - –ü–ª–∞–Ω—ã –ê–ª–∏—Å—ã (ID: 1)
  - –°–µ–∫—Ä–µ—Ç –ë–æ–±–∞ (ID: 2)

[–®–∞–≥ 2] –ê—Ç–∞–∫—É—é '–•–û–†–û–®–ò–ô' /search/good...
–†–µ–∑—É–ª—å—Ç–∞—Ç: 200
üîí –ê–¢–ê–ö–ê –û–¢–ë–ò–¢–ê! –°–µ—Ä–≤–µ—Ä –Ω–∏—á–µ–≥–æ –Ω–µ –≤–µ—Ä–Ω—É–ª (–ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫).
